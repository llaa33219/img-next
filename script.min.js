// script.min.js

const fileSelectButton = document.getElementById('fileSelectButton');
const fileInput = document.getElementById('fileInput');
const fileNameDisplay = document.getElementById('fileNameDisplay');
const uploadButton = document.getElementById('uploadButton');
const statusElem = document.getElementById('status');
const linkBox = document.getElementById('linkBox');
const copyButton = document.getElementById('copyButton');

// 파일 선택 시 파일명 업데이트
fileSelectButton.addEventListener('click', () => {
  fileInput.click();
});

fileInput.addEventListener('change', () => {
  if (fileInput.files.length > 0) {
    const names = Array.from(fileInput.files).map(f => f.name);
    fileNameDisplay.textContent = names.join(', ');
  } else {
    fileNameDisplay.textContent = '파일 선택 안됨';
  }
});

// 업로드 버튼 클릭 이벤트 (다중 파일 처리)
uploadButton.addEventListener('click', async () => {
  if (fileInput.files.length === 0) {
    statusElem.textContent = '파일이 선택되지 않았습니다.';
    return;
  }
  // 검열 단계 진행 중 메시지 표시
  statusElem.textContent = '검열 중...';
  const formData = new FormData();
  for (const file of fileInput.files) {
    formData.append('file', file);
  }
  // 일정 시간 후 검열이 완료되지 않으면 업로드 중 메시지로 변경
  const timer = setTimeout(() => {
    statusElem.textContent = '업로드 중...';
  }, 2000);
  try {
    const response = await fetch('/upload', {
      method: 'POST',
      body: formData
    });
    clearTimeout(timer);
    const result = await response.json();
    if (result.success) {
      linkBox.value = result.url;
      statusElem.textContent = '업로드 성공';
    } else {
      statusElem.textContent = '업로드 실패: ' + (result.error || '알 수 없는 에러');
    }
  } catch (err) {
    clearTimeout(timer);
    statusElem.textContent = '업로드 중 오류 발생: ' + err.message;
  }
});

// 복사 버튼 클릭 이벤트
copyButton.addEventListener('click', async () => {
  if (linkBox.value) {
    try {
      await navigator.clipboard.writeText(linkBox.value);
      statusElem.textContent = '링크가 복사되었습니다.';
    } catch (err) {
      statusElem.textContent = '복사 실패: ' + err.message;
    }
  }
});
