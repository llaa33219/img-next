// script.min.js

// 파일 선택 및 업로드 관련 DOM 요소 가져오기
const fileSelectButton = document.getElementById('fileSelectButton');
const fileInput = document.getElementById('fileInput');
const fileNameDisplay = document.getElementById('fileNameDisplay');
const uploadButton = document.getElementById('uploadButton');
const statusElem = document.getElementById('status');
const linkBox = document.getElementById('linkBox');
const copyButton = document.getElementById('copyButton');

// 파일 선택 버튼 클릭 시 파일 선택 창 열기
fileSelectButton.addEventListener('click', () => {
  fileInput.click();
});

// 파일 선택 후 파일 이름 업데이트
fileInput.addEventListener('change', () => {
  if (fileInput.files.length > 0) {
    const names = Array.from(fileInput.files).map(f => f.name);
    fileNameDisplay.textContent = names.join(', ');
  } else {
    fileNameDisplay.textContent = '파일 선택 안됨';
  }
});

// 업로드 버튼 클릭 시
uploadButton.addEventListener('click', async () => {
  statusElem.textContent = '';
  if (fileInput.files.length === 0) {
    statusElem.textContent = '파일이 선택되지 않았습니다.';
    return;
  }
  // 여러 파일 중 첫번째 파일만 처리 (추후 다중 업로드 확장이 가능함)
  const file = fileInput.files[0];

  // FormData 구성 – worker의 /upload 엔드포인트로 전송
  const formData = new FormData();
  formData.append('file', file);

  try {
    const response = await fetch('/upload', {
      method: 'POST',
      body: formData
    });
    const result = await response.json();
    if (result.success) {
      linkBox.value = result.url;
      statusElem.textContent = '업로드 성공';
    } else {
      statusElem.textContent = '업로드 실패: ' + (result.error || '알 수 없는 에러');
    }
  } catch (err) {
    statusElem.textContent = '업로드 중 오류 발생: ' + err.message;
  }
});

// 복사 버튼 클릭 시 링크 복사
copyButton.addEventListener('click', async () => {
  if (linkBox.value) {
    try {
      await navigator.clipboard.writeText(linkBox.value);
      statusElem.textContent = '링크가 복사되었습니다.';
    } catch (err) {
      statusElem.textContent = '복사 실패: ' + err.message;
    }
  }
});
